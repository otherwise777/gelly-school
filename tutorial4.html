<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>Tutorial4</title>

    <!-- Bootstrap core CSS -->
    <link href="./dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="navbar-fixed-top.css" rel="stylesheet">


    <script src="./assets/js/ie-emulation-modes-warning.js"></script>

  </head>

  <body>

<!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="./index.html">Gellyschool</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
             <ul class="dropdown-menu">
                                <li><a href="./tutorial0.html">Tutorial#0: Graphs 101</a></li>
                                <li><a href="./tutorial1.html">Tutorial#1: Create a Graph and run a Gelly library method</a></li>
                                <li><a href="./tutorial2.html">Tutorial#2: Know your Graph</a></li>
                                <li><a href="./tutorial3.html">Tutorial#3: Simple transformations</a></li>
                                <li><a href="./tutorial4.html">Tutorial#4: Advanced transformations</a></li>
                                <li><a href="./tutorial5.html">Tutorial#5: Neighborhood methods</a></li>
                                <li><a href="./tutorial6.html">Tutorial#6: Graph validation</a></li>
                                <li><a href="./tutorial7.html">Tutorial#7: Vertex-centric iterations</a></li>
                                <li><a href="./tutorial8.html">Tutorial#8: Gather-sum-apply iterations</a></li>
              </ul>
            </li>
            <li><a href="https://github.com/vasia/gelly-school">Solutions</a></li>
            <li><a href="https://ci.apache.org/projects/flink/flink-docs-master/libs/gelly_guide.html">Gelly Docs</a></li>
            <li><a href="./library.html" title="Gelly's Library Methods">Library Methods</a></li>
            <li><a href="./about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <!-- Begin page content -->
    <div class="container">
		      <div class="page-header">
        <h1>Advanced Transformations</h1>
      </div><p><img src="./images/transformations.jpg" align="right" /></p>
<h4>The business gets serious</h4>
<p>Let's carry on with applying some more but advanced transformations on our Gelly-Graph.</p><br>
<h4>Join</h4>
<p>Gelly provides specialized methods for joining the vertex and edge datasets with other input datasets. We are going to see how to use the <strong>joinWithVertices()</strong> method. <em>joinWithVertices()</em>joins the vertices with a Tuple2 input data set. The join is performed using the vertex ID and the first field of the Tuple2 input as the join keys. The method returns a new Graph where the vertex values have been updated according to a provided user-defined map function. 
<br><br>For example, if we want to update the vertex values in our <em>'twitter Graph'</em> (created in <a href="./tutorial1.html">Tutorial1</a>) with the number of followers for each user, then we proceed follows: 
<ul><li>Calculate the indegree of every Vertex </li>
<pre><code>    DataSet&lt;Tuple2&lt;Long, Long&gt;&gt; vertexInDegree = graph.<em style="color:blue">inDegrees()</em>;</pre></code><br>
<li>Perform a join with the DataSet of <vertex ID, in-degree> obtained in the previous step.</li>
<pre><code>    Graph&lt;Long, Long, NullValue&gt; updatedGraph = graph.<em style="color:blue">joinWithVertices</em>(vertexInDegree ,
		new MapFunction&lt;Tuple2&lt;Long,Long&gt;, Long&gt;() {
			 public Long <em style="color:brown">map</em>(Tuple2&lt;Long, Long&gt; value) {
				return value.f1;
			  }
			});	</pre></code><br>
<li>Apply the filter function to obtain users with number of followers exceeding some given threshold value N (possible filtering we mentioned performing at the end of our <a href="./tutorial3.html">last</a> tutorial).  
 
<pre><code>   
		
    Graph&lt;Long, Long, NullValue&gt; filteredGraph = updatedGraph.<em style="color:blue">filterOnVertices</em>(new FilterFunction&lt;Vertex&lt;Long, Long&gt;&gt;() {
		public boolean <em style="color:brown">filter</em>(Vertex&lt;Long, Long&gt; vertex) {
                   <em style="color:green">// keep only users with followers above N</em>
			return (vertex.getValue() &gt; N);
		   }
	   });  
	   
     <em style="color:green">// get the number of users with followers above N</em>
     Long usersWithFollowersAboveN = filteredGraph.<em style="color:blue">numberOfVertices()</em>;	   
</code></pre><br></p>

In case we want to store information regarding how many people a user follows, then instead of inDegree we just need to use the OutDegree. With our sample data set, you can write your function and verify that there are 4 users who are following more than 200 people.<br><br>
<p></p>
<h4>Union</h4>
<p>For instance, if you want to merge the graphs of two different social networks then you can resort to Gelly’s union() method which performs a union operation on the vertex and edge sets of the specified graph and current graph. Duplicate vertices are removed from the resulting Graph, while if duplicate edges exists, these will be maintained as shown in the figure below.</p>
<p><code>network1.union(network2);</code></p>
<p><img src="./images/union.jpg"/></p> 
<br><br>
<p></p>
<h4>Difference</h4>
<p>Gelly’s difference() method performs a difference on the vertex and edge sets of the current graph and specified graph. So in case we have two graphs and we want to analyse the difference in connectivity or for instance which users are present in one graph and not the other, then we can simply call the difference method.</p>
<br><p>This concludes our discussion regarding transformations in Gelly. Next, we are going to look at some other advanced topics like neighborhood methods and graph validation.</p><br>

	<p><h4><a style="margin-left: 100px" href="./tutorial3.html"><em><--Previous</em></a> <a style="margin-left: 650px" href="./tutorial5.html"><em>Next--></em></a></h4></p>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
