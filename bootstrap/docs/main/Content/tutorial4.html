<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Tutorial4</title>

    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="navbar-fixed-top.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top ">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Gelly</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="./home.html">Home</a></li>
            <li><a href="https://github.com/apache/flink/tree/master/flink-staging/flink-gelly" title="Gelly's SourceCode">GitHub</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
              <ul class="dropdown-menu">
			  	<li><a href="./tutorial0.html" title="Introduction to Gelly">Tutorial0</a></li>
				<li><a href="./tutorial1.html" title="Load public data and create a graph and run a library method">Tutorial1</a></li>
				<li><a href="./tutorial2.html" title="Know your graph">Tutorial2</a></li>
				<li><a href="./tutorial3.html" title="Simple transformations">Tutorial3</a></li>
				<li><a href="./tutorial4.html" title="Advanced transofrmations">Tutorial4</a></li>
				<li><a href="./tutorial5.html" title="Neighborhood methods">Tutorial5</a></li>
				<li><a href="./tutorial6.html" title="Implement a graph validator">Tutorial6</a></li>
				<li><a href="./tutorial7.html" title="Vertex-centric iterations">Tutorial7</a></li>
				<li><a href="./tutorial8.html" title="Gather-sum-apply iterations">Tutorial8</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


    <!-- Begin page content -->
    <div class="container">
		      <div class="page-header">
        <h1>Advanced Transformations</h1>
      </div><p><img src="./images/transformations.jpg" align="right" /></p>
<h4>The business gets serious</h4>
<p>Let's carry on with applying some more but advanced transformations on our Gelly-Graph.</p><br>
<h4>Join</h4>
<p>Gelly provides specialized methods for joining the vertex and edge datasets with other input datasets. <strong>joinWithVertices</strong> joins the vertices with a Tuple2 input data set. The join is performed using the vertex ID and the first field of the Tuple2 input as the join keys. The method returns a new Graph where the vertex values have been updated according to a provided user-defined map function. 
<br>Similarly, an input dataset can be joined with the edges, using one of the three methods:
 <br><strong>joinWithEdges</strong> expects an input DataSet of Tuple3 and joins on the composite key of both source and target vertex IDs.
 <br><strong>joinWithEdgesOnSource</strong> expects a DataSet of Tuple2 and joins on the source key of the edges and the first attribute of the input dataset and applies a user defined function (mapper) on the resulted values.<br><strong>joinWithEdgesOnTarget</strong> expects a DataSet of Tuple2 and joins on the target key of the edges and the first attribute of the input dataset and applies a user defined function on the resulted values.<br> All three methods apply a map function on the edge and the input data set values. Note that if the input dataset contains a key multiple times, all Gelly join methods will only consider the first value encountered.<br><br>For example, if we want to update the vertex values in our <em>'twitter Graph'</em> (created in <a href="./tutorial1.html">Tutorial1</a>), with the number of followers for each user, then first we calculate the indegree of every Vertex and then we perform a join with the resulting DataSet. In this way, we can apply the filter function to obtain users 
 with number of followers exceeding some given threshold value N, possible filtering we mentioned performing at the end of our <a href="./tutorial3.html">last</a> tutorial.  </p><br>
 
<pre><code>    DataSet&lt;Tuple2&lt;Long, Long&gt;&gt; vertexInDegree = graph.inDegrees();

    Graph&lt;Long, Long, NullValue&gt; updatedGraph = graph.joinWithVertices(vertexInDegree ,
		new MapFunction&lt;Tuple2&lt;Long,Long&gt;, Long&gt;() {
			 public Long map(Tuple2&lt;Long, Long&gt; value) {
				return value.f1;
			  }
			});	
				
		
    Graph&lt;Long, Long, NullValue&gt; filteredGraph = updatedGraph.filterOnVertices(new FilterFunction&lt;Vertex&lt;Long, Long&gt;&gt;() {
		public boolean filter(Vertex&lt;Long, Long&gt; vertex) {
			// keep only vertices with positive values
			return (vertex.getValue() &gt; N);
		   }
	   });   

     Long usersWithFollowersAboveN = filteredGraph.numberOfVertices();	   
</code></pre><br>

In case we want to store information regarding how many people a user follows, then instead of inDegree we just need to use the OutDegree. With our sample data set, you can write your function and verify that there are 4 users who are following more than 200 people.<br><br>
<p></p>
<h4>Union</h4>
<p>Gelly’s union() method performs a union operation on the vertex and edge sets of the specified graph and current graph. Duplicate vertices are removed from the resulting Graph, while if duplicate edges exists, these will be maintained.</p>
<p><code>network1.union(network2);</code></p>
<p><img src="./images/union.jpg"/></p>
A union can be used for instance to merge the graphs of two different social networks. 
<br><br>
<p></p>
<h4>Difference</h4>
<p>Gelly’s difference() method performs a difference on the vertex and edge sets of the current graph and specified graph. So in case we have two graphs and we want to analyse the difference in connectivity or for instance which users are present in one graph and not the other, then we can simply call the difference method.</p>
<br><p>This concludes our discussion regarding transformations in Gelly. Next, we are going to look at some other advanced topics like neighborhood methods and graph validation.</p><br>

	<p><h4><a style="margin-left: 100px" href="./tutorial3.html"><em><--Previous</em></a> <a style="margin-left: 650px" href="./tutorial5.html"><em>Next--></em></a></h4></p>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
