<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>Tutorial1</title>

    <!-- Bootstrap core CSS -->
    <link href="./dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="navbar-fixed-top.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="./assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="./assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Gelly</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="./index.html">Home</a></li>
            <li><a href="https://github.com/apache/flink/tree/master/flink-staging/flink-gelly" title="Gelly's SourceCode">GitHub</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
              <ul class="dropdown-menu">
			  	<li><a href="./tutorial0.html" title="Introduction to Gelly">Tutorial0</a></li>
				<li><a href="./tutorial1.html" title="Load public data and create a graph and run a library method">Tutorial1</a></li>
				<li><a href="./tutorial2.html" title="Know your graph">Tutorial2</a></li>
				<li><a href="./tutorial3.html" title="Simple transformations">Tutorial3</a></li>
				<li><a href="./tutorial4.html" title="Advanced transofrmations">Tutorial4</a></li>
				<li><a href="./tutorial5.html" title="Neighborhood methods">Tutorial5</a></li>
				<li><a href="./tutorial6.html" title="Implement a graph validator">Tutorial6</a></li>
				<li><a href="./tutorial7.html" title="Vertex-centric iterations">Tutorial7</a></li>
				<li><a href="./tutorial8.html" title="Gather-sum-apply iterations">Tutorial8</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


    <!-- Begin page content -->
    <div class="container">
      <div class="page-header">
        <h1>Load public data, create a graph and run a library method</h1>
      </div>
	        <p>
				<img src="./images/started.jpg" align="right" />
			</p>
			<h3>Here comes Gelly</h3>
			<p>We start delving into Gelly by focusing on the following three concepts in this tutorial:
			<ul>
			<li>Graph representation</li>
			<li>Graph creation from public data</li>
			<li>Running a Gelly library method</li>
			</ul>
			<h4>Some Basics</h4>
			<p>
			A Graph is represented by two DataSets: Vertices and Edges. Vertices and edges might or might not have associated values.
			Let’s see some examples:
			</p><br>
		      <pre><code><em style="color:green">  //creates a vertex with long Id and String value</em>
   Vertex&lt;Long, String&gt; v1 = new <em style="color:brown">Vertex</em>&lt;Long, String&gt;(1L, &quot;foo&quot;);<br>
 <em style="color:green"> //creates an edge with double value</em>
   Vertex&lt;Long, String&gt; v2 = new <em style="color:brown">Vertex</em>&lt;Long, String&gt;(2L, &quot;goo&quot;);<br>
 <em style="color:green"> //creates an edge without a value</em>
   Edge&lt;Long, Double&gt; e = new <em style="color:brown">Edge</em>&lt;Long, Double&gt;(1L, 2L, NullValue);</code></pre><br>
   
			<p>Graph datasets are often available as a single list of edges. In this case, Gelly can read only the edge input and automatically infer the graph vertices.</p>
			<p>
				<img src="./images/tut1_1.jpg"/>
			</p><br>
		

			<h3>Create a graph from public data</h3>	
            <p>Let’s see how to create a graph in practice! For this series of tutorials, we are going to use the twitter dataset from<a href="http://konect.uni-koblenz.de/networks/ego-twitter">konect</a>. In the network page, you can find several properties and measurements about this dataset. It is a directed, unweighted network with 23370 vertices and 33101 edges. Let’s get the dataset and try to reproduce some of these results with Gelly!</p>			

			<h4>Step1: Go to the webpage and download the TSV edges file</h4>
			<p>Go to the webpage and download the TSV edges file. The file is quite small and you can easily open it and check it out on your laptop. You will see that the first two lines start with “%” and contain information about the data. Next, each line represents an edge and Ids are separated by a space character:<br><br><em>
			 % asym unweighted<br>
             % 33101 938 22964<br>
             1 2 <br>
             1 3 <br>
             1 4 <br>
             1 5 <br>
             ...</em></p>
			
			<h4>Step2:Load the data in a Flink DataSet</h4>
			<p>We will use Flink’s readAsCsv method to read the edge data and create an edges DataSet. 
			Flink’s CSV reader has convenient methods that let us:
			<ul>
			<li>Define the line delimiter. In our this is the delimiter that separated edges, ‘\n’.</li>
            <li>Define the field delimiter. In our case this is the space character ‘ ’ that separates the edge Ids.</li>
            <li>Ignore comments; lines that start with a certain character. Using this feature, we can instruct Flink to ignore the first 2 lines of the file.
			Define the field types. We will read the edge Ids as Longs.</li></p>
						<pre>           <code><em style="color:green">//read a file and creates a DataSet of Tuple2</em>
	    DataSet&lt;Tuple2&lt;Long, Long&gt;&gt; edgeTuples = env.<em style="color:blue">readCsvFile</em>(args[0])
                    .fieldDelimiter(&quot; &quot;)
                    .lineDelimiter(&quot;\n&quot;)
                    .types(Long.class, Long.class);</pre></code>

		    <h4>Step3: Create a Graph</h4>
			<p>Since the Twitter graph has no edge values, we are going to set them to NullValue when creating the edges DataSet. We can easily do this by applying a map function to the DataSet we have just read:</p>
			
			<pre><code>DataSet&lt;Edge&lt;Long, NullValue&gt;&gt= edgeTuples.<em style="color:blue">map</em>(new MapFunction&lt;Tuple2&lt;Long, Long&gt;, Edge&lt;Long, NullValue&gt;&gt;() {
			
                        public Edge&lt;Long, NullValue&gt;<em style="color:brown"> map</em>(Tuple2&lt;Long, Long&gt; value) {
                            return new Edge&lt;Long, NullValue&gt;(value.f0, value.f1,
                                    NullValue.getInstance());
                                }
                            });
			</pre></code>
			<p>Now we are ready to create the Graph! We are going to use Gelly’s fromDataSet method, which will induce the vertices directly from the edges. In this method, we can also provide a mapper to create the vertex values. The mapper gives us the vertex Id as a parameter and lets us set the vertex value to an arbitrary value. This allows us to create the graph and initialize the vertex values in one step! For our example, we will set the vertex values to 1.0, in order to later run the PageRank algorithm on the graph.</p>
			
		<pre><code><em style="color:green">//use the edges DataSet to create a Graph</em>
 Graph&lt;Long, Double, NullValue&gt; graph = Graph.<em style="color:blue">fromDataSet</em>(links, new MapFunction&lt;Long, Double&gt;() {
 
		<em style="color:green">//mapping function to initialize vertex values to 1.0</em>
		public Double <em style="color:brown">map</em>(Long value) throws Exception {
			return 1.0;
			}
		}, env);
        </code></pre><br>

	
			<h4>Running a library method</h4><p><img src="./images/running.jpg" align="right"/></p>
			<p>
			Gelly provides a collection of graph algorithms for easily analyzing large-scale Graphs. 
			The library methods can be used by simply calling the run() method on the input graph. For example, 
			to execute the PageRank Algorithm on our graph we call the run method as follows: 
<p><code>    DataSet&lt;Vertex&lt;Long, Double&gt;&gt; pageRanks = graph.run(
            new PageRankAlgorithm&lt;Long&gt;(DAMPENING_FACTOR, maxIterations)).getVertices();
</code></p>
            The result is a DataSet of vertices where each Vertex ID is associated with its PageRank.
			Here, the purpose is just to show  how to call a library method so we are ignoring the details
			regarding the algorithm. We will talk about it again, in a detailed manner, in the following more advanced tutorials.		
			</p>
			<br>
			<h4>It was that easy</h4>
			<p>
				We have learnt how to create a Graph in Gelly from a given input data set. In the next tutorial, we will get to know some
				details regarding the Graph we have just created. </p><br>

	<p><h4><a style="margin-left: 100px" href="./tutorial0.html"><em><--Previous</em></a> <a style="margin-left: 650px" href="./tutorial2.html"><em>Next--></em></a></h4></p>
	<br><br>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
