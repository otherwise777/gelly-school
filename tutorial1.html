<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>Tutorial1</title>

    <!-- Bootstrap core CSS -->
    <link href="./dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="navbar-fixed-top.css" rel="stylesheet">

    <script src="./assets/js/ie-emulation-modes-warning.js"></script>


  </head>

  <body>

<!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="./index.html">Gellyschool</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
              <ul class="dropdown-menu">
              <li><a href="./tutorial0.html">Tutorial#0: Graphs 101</a></li>
                                <li><a href="./tutorial1.html">Tutorial#1: Create a Graph and run a Gelly library method</a></li>
                                <li><a href="./tutorial2.html">Tutorial#2: Know your Graph</a></li>
                                <li><a href="./tutorial3.html">Tutorial#3: Simple transformations</a></li>
                                <li><a href="./tutorial4.html">Tutorial#4: Advanced transformations</a></li>
                                <li><a href="./tutorial5.html">Tutorial#5: Neighborhood methods</a></li>
                                <li><a href="./tutorial6.html">Tutorial#6: Graph validation</a></li>
                                <li><a href="./tutorial7.html">Tutorial#7: Vertex-centric iterations</a></li>
                                <li><a href="./tutorial8.html">Tutorial#8: Gather-sum-apply iterations</a></li>
		</ul>
            </li>
            <li><a href="https://github.com/vasia/gelly-school/tree/solutions">Solutions</a></li>
            <li><a href="https://ci.apache.org/projects/flink/flink-docs-master/libs/gelly_guide.html">Gelly Docs</a></li>
            <li><a href="./library.html" title="Gelly's Library Methods">Library Methods</a></li>
            <li><a href="./about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <!-- Begin page content -->
    <div class="container">
      <div class="page-header">
        <h1>Create a Graph and run a library method</h1>
      </div>
			<h3>Hello, Gelly!</h3>
			<p>In this first tutorial, we are going to learn how to
			<ul>
			<li>Create a Graph from a text file of edges</li>
			<li>Run a Gelly library method</li>
			</ul>
			<h4>Some Basics</h4>
			<p>
      In Gelly, vertices and edges are defined as Flink <a href="https://ci.apache.org/projects/flink/flink-docs-master/apis/programming_guide.html#data-types">Tuples</a>. Tuples are composite data types that contain a fixed number of fields.
      A Vertex is a <i>Tuple2</i>, where the first field corresponds to the Vertex ID and the second field corresponds to the Vertex value.
      An Edge is a <i>Tuple3</i>, where the first field is the ID of the source vertex, the second field is the ID of the target vertex and the third field is the edge value.</p>

<div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">// create a vertex with ID=42 and value=0.8</span>
Vertex<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Double<span style="color: #666666">&gt;</span> v <span style="color: #666666">=</span> <span style="color: #AA22FF; font-weight: bold">new</span> Vertex<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Double<span style="color: #666666">&gt;(42,</span> <span style="color: #666666">0.8);</span>

<span style="color: #008800; font-style: italic">// create an edge from 5 to 6 with value=&quot;foo&quot;</span>
Edge<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Integer<span style="color: #666666">,</span> String<span style="color: #666666">&gt;</span> e <span style="color: #666666">=</span> <span style="color: #AA22FF; font-weight: bold">new</span> Edge<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Integer<span style="color: #666666">,</span> String<span style="color: #666666">&gt;(5,</span> <span style="color: #666666">6,</span> <span style="color: #BB4444">&quot;foo&quot;</span><span style="color: #666666">);</span>
</pre></div>

<br><p>To define vertices and edges without associated values, we use the <b>NullValue</b> type:</p>

<div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">// create a vertex with ID=42 and no value</span>
Vertex<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;</span> v <span style="color: #666666">=</span> <span style="color: #AA22FF; font-weight: bold">new</span> Vertex<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;(42,</span> NullValue<span style="color: #666666">.</span><span style="color: #BB4444">getInstance</span><span style="color: #666666">());</span>

<span style="color: #008800; font-style: italic">// create an edge from 5 to 6 with no value</span>
Edge<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Integer<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;</span> e <span style="color: #666666">=</span> <span style="color: #AA22FF; font-weight: bold">new</span> Edge<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Integer<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;(5,</span> <span style="color: #666666">6,</span> NullValue<span style="color: #666666">.</span><span style="color: #BB4444">getInstance</span><span style="color: #666666">());</span>
</pre></div>



<br><p>Graphs can be represented in many different ways: a list of edges, an <a href="https://en.wikipedia.org/wiki/Adjacency_list">adjacency list</a>,
      an <a href="https://en.wikipedia.org/wiki/Adjacency_matrix">adjacency matrix</a>, a list of vertices and a list of edges.
      In Gelly, Graphs are represented by a set of vertices and a set of edges. Internally, these sets are Flink <a href="https://ci.apache.org/projects/flink/flink-docs-master/apis/programming_guide.html#dataset-abstraction"> DataSet</a>s. They might be distributed over several nodes in a cluster or they might never get materialized!
      You can create a Graph in Gelly by providing both the vertices and edges DataSets or just the edges, in case the vertices have no associated values.
			</p>
      <p><img src="./images/tut1_ex2.png" hspace="20"/> <img src="./images/tut1_ex1.png" hspace="20"/></p>

      Vertices and edges are usually given as plain text files or in the form of collections. Luckily, Flink comes with utilities for creating DataSets from many different data sources. You can find a complete reference in the <a gref="https://ci.apache.org/projects/flink/flink-docs-master/apis/programming_guide.html#data-sources">Flink documentation</a>. You can create Graphs from DataSets of Tuples, as well as from Vertex and Edge DataSets:

<p><div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">ExecutionEnvironment env <span style="color: #666666">=</span> ExecutionEnvironment<span style="color: #666666">.</span><span style="color: #BB4444">getExecutionEnvironment</span><span style="color: #666666">();</span>

<span style="color: #008800; font-style: italic">// create a Graph from Vertex and Edge DataSets</span>
DataSet<span style="color: #666666">&lt;</span>Vertex<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> Long<span style="color: #666666">&gt;&gt;</span> vertices <span style="color: #666666">=</span> <span style="color: #666666">...</span>
DataSet<span style="color: #666666">&lt;</span>Edge<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> Double<span style="color: #666666">&gt;&gt;</span> edges <span style="color: #666666">=</span> <span style="color: #666666">...</span>

Graph<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> Long<span style="color: #666666">,</span> Double<span style="color: #666666">&gt;</span> g1 <span style="color: #666666">=</span> Graph<span style="color: #666666">.</span><span style="color: #BB4444">fromDataSet</span><span style="color: #666666">(</span>vertices<span style="color: #666666">,</span> edges<span style="color: #666666">,</span> env<span style="color: #666666">);</span>

<span style="color: #008800; font-style: italic">// create a Graph from a Tuple3 DataSet</span>
DataSet<span style="color: #666666">&lt;</span>Edge<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> Double<span style="color: #666666">&gt;&gt;</span> tupleEdges <span style="color: #666666">=</span> <span style="color: #666666">...</span>

Graph<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> NullValue<span style="color: #666666">,</span> Double<span style="color: #666666">&gt;</span> g2 <span style="color: #666666">=</span> Graph<span style="color: #666666">.</span><span style="color: #BB4444">fromTupleDataSet</span><span style="color: #666666">(</span>tupleEdges<span style="color: #666666">,</span> env<span style="color: #666666">);</span>
</pre></div></p>

<p>As you probably noticed, Graph expects three types: the vertex ID type, the vertex value type and the edge value type. </p>
	

			<h3>Let's get started!</h3>	
      <p>Now that you have seen how to represent graphs in Gelly, it's time to analyze some real data!
      Go ahead and get the skeleton code of this tutorial from the <a href="https://github.com/vasia/gelly-school/blob/gelly-tutorials/src/main/java/flink/gelly/school/Tutorial1.java">github repository</a> or copy and fill in the code snippets that we provide below.
      </p>

      <h4>Data</h4>
      For this tutorial, we are going to use a Twitter graph from the <a href="http://konect.uni-koblenz.de/">Koblenz Network Collection</a>.
      You can download the data from <a href="http://konect.uni-koblenz.de/networks/munmun_twitter_social">this page</a>, where you will also find several properties and metrics of the network. Nodes in this network represent Twitter users and an edge shows that the left user follows the right one.		
      The edges file is quite small and you can easily open it and check it out on your laptop. You will see that the first two lines start with “%” and contain information about the data. Each of the following lines defines a directed, unweighted edge and IDs are separated by a space character: <br><br>

			<p><em> % asym unweighted<br>
              % 834797 465017 465017<br>
              1 2 <br>
              1 3 <br>
              1 4 <br>
              1 5 <br>
             ...</em></p><br>
			
			<h4>Step#1: Load the data in a DataSet</h4>
			<p>You can read this file using Flink’s <b>readCsvFile()</b> method. Flink’s CSV reader has convenient methods that lets us
			define the line delimiter and the field delimiter. In our case lines are separated by the new line character "\n" and fields by spaces.
      You can also ignore comments; lines that start with a certain character. Using this feature, we can instruct Flink to ignore the first 2 lines of the file.
			Finally, we have to define the field types. We will read the edge IDs as Longs. Since there are no edge values, we will use a simple mapper to set the third field of the edges to NullValue:</p>
	
<div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">// Step #1:  Load the data in a DataSet</span>
DataSet<span style="color: #666666">&lt;</span>Tuple3<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;&gt;</span> twitterEdges <span style="color: #666666">=</span> env<span style="color: #666666">.</span><span style="color: #BB4444">readCsvFile</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;/path/to/the/input/file&quot;</span><span style="color: #666666">)</span>
            <span style="color: #666666">.</span><span style="color: #BB4444">fieldDelimiter</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;...&quot;</span><span style="color: #666666">)</span>  <span style="color: #008800; font-style: italic">// node IDs are separated by spaces</span>
            <span style="color: #666666">.</span><span style="color: #BB4444">ignoreComments</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;...&quot;</span><span style="color: #666666">)</span>  <span style="color: #008800; font-style: italic">// comments start with &quot;%&quot;</span>
            <span style="color: #666666">.</span><span style="color: #BB4444">types</span><span style="color: #666666">(...)</span> <span style="color: #008800; font-style: italic">// read the node IDs as Longs</span>

            <span style="color: #008800; font-style: italic">// set the edge value to NullValue with a mapper</span>
            <span style="color: #666666">.</span><span style="color: #BB4444">map</span><span style="color: #666666">(</span><span style="color: #AA22FF; font-weight: bold">new</span> MapFunction<span style="color: #666666">&lt;</span>Tuple2<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">&gt;,</span> Tuple3<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;&gt;()</span> <span style="color: #666666">{</span>

              <span style="color: #AA22FF">@Override</span>
              <span style="color: #AA22FF; font-weight: bold">public</span> Tuple3<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;</span> map<span style="color: #666666">(</span>Tuple2<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">&gt;</span> tuple<span style="color: #666666">)</span> <span style="color: #666666">{</span>
                <span style="color: #AA22FF; font-weight: bold">return</span> <span style="color: #AA22FF; font-weight: bold">new</span> Tuple3<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;(...);</span>
              <span style="color: #666666">}</span>
            <span style="color: #666666">});</span>
</pre></div><br>

		  <h4>Step#2: Create a Graph and initialize the Vertex values</h4>

			<p>Now we are ready to create the Graph! When creating a graph from edges, Gelly allows us to initialize the vertices by defining a mapper. The mapper is given as a parameter to the graph creation metho and lets us map each vertex ID to an arbitrary value. Here, we will initialize each vertex with a value equal to its ID, i.e. vertex 1 will have value 1, vertex 2 will have value 2, vertex 42 will have value 42 and so on.</p>

<div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">// Step #2: Create a Graph and initialize vertex values</span>
Graph<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">,</span> NullValue<span style="color: #666666">&gt;</span> graph <span style="color: #666666">=</span> Graph<span style="color: #666666">.</span><span style="color: #BB4444">fromTupleDataSet</span><span style="color: #666666">(...,</span> <span style="color: #AA22FF; font-weight: bold">new</span> InitVertices<span style="color: #666666">(),</span> env<span style="color: #666666">);</span>
</pre></div>

<div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">/**</span>
<span style="color: #008800; font-style: italic"> * Initializes the vertex values with the vertex ID</span>
<span style="color: #008800; font-style: italic"> */</span>
<span style="color: #AA22FF; font-weight: bold">public</span> <span style="color: #AA22FF; font-weight: bold">static</span> <span style="color: #AA22FF; font-weight: bold">final</span> <span style="color: #AA22FF; font-weight: bold">class</span> <span style="color: #0000FF">InitVertices</span> <span style="color: #AA22FF; font-weight: bold">implements</span> MapFunction<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">&gt;</span> <span style="color: #666666">{</span>

  <span style="color: #AA22FF">@Override</span>
  <span style="color: #AA22FF; font-weight: bold">public</span> Long <span style="color: #00A000">map</span><span style="color: #666666">(</span>Long vertexId<span style="color: #666666">)</span> <span style="color: #666666">{</span>
    <span style="color: #AA22FF; font-weight: bold">return</span> vertexId<span style="color: #666666">;</span>
  <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
</pre></div>



	
			<br><h4>Step #3: Run Connected Components</h4>
			<p> Connectivity is one of the very basic and highly useful concepts in graph theory. It is a measure of robustness and can give us information on existing paths between nodes. A directed graph is called <i>weakly connected</i> if replacing all of its directed edges with undirected edges produces a connected (undirected) graph. In other words, all nodes can be reached from all other nodes in the network, following undirected edges. Groups of nodes in a graph that can be reached from each other following undirected edges are called <i>Connected Components</i>. Thus, a graph with a single connected component is weakly connected.
        <br>The following image shows a graph with two components:</p>

        <p><img src="./images/tut1_ex3.png" hspace="20"/></p>

			<p>Gelly provides a collection of graph algorithms for easily analyzing graphs. These algorithms are available as library methods and can be used by simply calling the <b>run()</b> method on the input graph. Computing connected components is one of them. In this algorithm, initially, each vertex belongs to its own component (its ID). The algorithm proceeds in iterations, where vertices exchange component IDs with their neighbors, until all vertices that belong to the same component have adopted the same ID. We will leave the details on how iterations work in Gelly for <a href="./tutorial7.html">Tutorial#7</a>. For now, all you need to know is that calling <b>ConnectedComponents()</b> on your graph will return a DataSet of vertices, where the vertex values correspond to the component ID. The library method takes only one parameter, the maximum number of iterations. You can set this to 10 for the given dataset.</p> 

<div style="background: #f8f8f8; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">// Step #3: Run Connected Components</span>
DataSet<span style="color: #666666">&lt;</span>Vertex<span style="color: #666666">&lt;</span>Long<span style="color: #666666">,</span> Long<span style="color: #666666">&gt;&gt;</span> verticesWithComponents <span style="color: #666666">=</span> graph<span style="color: #666666">.</span><span style="color: #BB4444">run</span><span style="color: #666666">(</span><span style="color: #AA22FF; font-weight: bold">new</span> ConnectedComponents<span style="color: #666666">(...)).</span><span style="color: #BB4444">getVertices</span><span style="color: #666666">();</span>
</pre></div>

<br><h4>Piece of cake!</h4>
<p>If you've made it so far and you've filled in the gaps, you can print and inspect the results. You should see that all vertices have been assigned the component ID 1, which means that the given Twitter graph is indeed weakly connected!
  <br>In the next tutorial, we are going to see how to retrieve vertices and edges from a graph and how to compute metrics and statistucs. Until then, you might want to play around with the rest of Gelly's <a href="./library.html">library methods</a> and compute PageRank or discover communities in your graph!</p><br>

<p><h4><a style="margin-left: 100px" href="./tutorial0.html"><em><--Previous</em></a> <a style="margin-left: 650px" href="./tutorial2.html"><em>Next--></em></a></h4></p>
<br><br>
</div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
